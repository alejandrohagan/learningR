<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>learningr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="learningR_files/libs/clipboard/clipboard.min.js"></script>
<script src="learningR_files/libs/quarto-html/quarto.js"></script>
<script src="learningR_files/libs/quarto-html/popper.min.js"></script>
<script src="learningR_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="learningR_files/libs/quarto-html/anchor.min.js"></script>
<link href="learningR_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="learningR_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="learningR_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="learningR_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="learningR_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="how-to-save-things-on-git" class="level1">
<h1>How to save things on Git</h1>
<ul>
<li>You can either save on a local site or you can push to a version sharing repository.</li>
<li>Critical that you get familiar with version sharing site</li>
</ul>
<p>how to connect to github</p>
<p>while all this may seem to new, quite honestly its because we have never been told good versioning and collaboration practices so we are reliant on saving to a LAN system, amending the name with versioning control</p>
<p>create a new github repsository in github</p>
<p>go to global settings (not repository settings), go to develrop settings and click personal access tokens</p>
<p>generate new token, copy (consider saving as you can only see it once)</p>
<p>save token with credentials::set_github_pat()</p>
<p>check everything with gitcreds_get()</p>
<p>git config –global credential.helper ‘cache –timeout=10000000’</p>
<p>usethis::git_branch_default()</p>
<p>check local branch</p>
<p>gert::git_remote_ls()</p>
<p>get information</p>
<p>resources</p>
<p>https://rfortherestofus.com/2021/02/how-to-use-git-github-with-r/</p>
<p>{r} usethis::use_git_remote(“origin”,url=NULL,overwrite=TRUE) usethis::use_github() usethis::gh_token_help()</p>
<p>usethis::use_git_remote(name = “origin”,url = “https://github.com/alejandrohagan/learningR.git”,overwrite=TRUE)</p>
<p>gitcreds::gitcreds_set(url = “https://github.com/alejandrohagan/learningR.git”)</p>
<p>usethis::use_github() usethis::git_default_branch()</p>
<p>gh::gh_whoami()</p>
<p>usethis::git_remotes()</p>
<p>usethis::pr_push()</p>
<p>usethis::pr_fetch()</p>
<p>usethis::pr_pull()</p>
<p>usethis::pr_init(branch = “main”)</p>
<p>git config pull.rebase false</p>
<p>usethis::use_git_remote(name = “origin”,url = “https://github.com/alejandrohagan/learningR.git”,overwrite=TRUE))</p>
<p>• To create a personal access token, call <code>create_github_token()</code> • To store a token for current and future use, call <code>gitcreds::gitcreds_set()</code></p>
<p>5 steps to change GitHub default branch from master to main | R-bloggers</p>
<p>Don’t Lose your HEAD over Default Branches | R-bloggers</p>
<p>Git: Moving from Master to Main | R-bloggers</p>
<p>push &amp; committ and commenting</p>
<p>How to manipulate &amp; tidy data</p>
<p>##how to import data———-</p>
<p>read.csv()</p>
<p>read_csv()</p>
<p>fread()</p>
<p>##how to change column types—-</p>
<p>how to create data</p>
<p>seq() runif() sample(data,# of times, replace,) c() data.frame()</p>
<p>how to create data with basic loops / repitition</p>
<p>types of data</p>
<p>vector data.frame list</p>
<p>some base R basics that will be helpful to you as you read the forums</p>
<p>how to import files</p>
<p>by folder</p>
<p>by website</p>
<p>excel spreadsheet</p>
<p>powerbi model</p>
<p>how to find files by their type</p>
<p>how to append files together</p>
<p>how to automate file importation</p>
<p>file column names</p>
<p>how to change column names</p>
<p>statically</p>
<p>dynamically</p>
<p>best practices when naming columns</p>
<p>how to change column types</p>
<p>statically</p>
<p>dynamically</p>
<p>how to check data structure</p>
<p>-unique</p>
<p>how to clean data</p>
<p>how to shape data</p>
<p>how to subset data</p>
<p>filter</p>
<p>dynamic</p>
<p>static</p>
<p>select</p>
<p>dynamic</p>
<p>static</p>
<p>grouby</p>
<p>summarize</p>
<p>mutate</p>
<p>fill / blanks/ replace values</p>
<p>recode</p>
<p>pivot / unpivot</p>
<p>merge</p>
<p>iterate</p>
<p>apply a single function (single input or multiple inputs) to every/ some/ based on criteria column and get its outputs into a data frame (to be accessed)</p>
<p>apply a single function with multiple inputs</p>
<p>apply a functions to nested data frames</p>
<p>explatory analysis</p>
<p>start with variance analysis</p>
<p>how to extract information out of a table</p>
<p>for (i in range){</p>
<p>do something }</p>
<p>basic framework 1. is to define the vector that you want as an output and its size with vector(“type”,vectorsize) 2. assign that vector names with names() so that data has headings 3. create for (i in range) 4. define the task it will do individually to thedataset 4. assign that to the output vector</p>
<p>tips &amp; tricks</p>
<p>check the task individually against a single element to ensure it works</p>
<p>you can extract other elements (typically row / column names) using other techniques (names()) and assign to output (doesn’t need to be in the loop) -use seq_along(), ncol(), [[]] to define parameters and extract elements</p>
<p>{r loop_example, message=FALSE, warning=FALSE} output &lt;- vector(“double”,ncol(mtcars)) #assigns the output vector</p>
<p>cols_names &lt;- names(mtcars) # assigns names of the dataframe to variable names(output) &lt;- cols_names # assigns the names</p>
<p>for (i in cols_names) { # sometimes useful to use seq_along() here as well</p>
<p>output[i] &lt;- mean(mtcars[[i]]) # the double brackets ensures we only take out one item, this needs to be adjusted if two iems are expected, change the vector to a list</p>
<p>}</p>
<p>output</p>
<section id="categorical-variables" class="level3">
<h3 class="anchored" data-anchor-id="categorical-variables">Categorical Variables</h3>
<p>In general you will need to distinguish betwen your character values as either straight character or categorical with levels</p>
<p>This becomes critical as you look to create categories and relationships in your data</p>
<p>forecats is the gotopackage in particular:</p>
<p>rename</p>
<p>recode() to change values in column</p>
<p>recode(col,newvalue=oldvalue)</p>
<p>reorder</p>
<p>fct_relevel</p>
<p>fct_relevel(col,level1,level2,etc)</p>
<p>fct_reorder(col,col_to_be_reorderby,function)</p>
<p>3)group variables into another group</p>
<p>case_when()</p>
<p>-typically used in combination with mutate() -can reference multiple conditions</p>
<p>case_when(col1==var1 ~ val1, col1==var2 &amp; col3==var3 ~ var 2, is.na(col1) ~ “missingvalue”, TRUE ~ “defaultvalue )` cut()</p>
<p>##purr</p>
<p>{ } is used to stop a data frame from passing into as first agurmen</p>
<p>. is a place holder for the data frame</p>
<p>{r } list.len=3 str(mpg,list.len=3)</p>
<p>str(mpg) listviewer::jsonedit(mpg)</p>
<p>#patchwork</p>
<p>can organize with easy convention +,/,| is two charts on top and one chart beneath</p>
<p>but can also supplement with additional functions</p>
<p>plot_layout can also arrnage by rows</p>
<p>plot_layout(nrow = 3, byrow = FALSE) arguments: width= changes the graphs relative width size, when given as a numeric c(2,1) then the first columsn graphs are twice as large as the second columns height= changes the graphs reltive row heigh, ncol= numeric, changes number of columsn guides=“collect” to remove duplicate guides theme(legend.position=‘bottom’) moves the legend position</p>
<p>guide_area() to create area that guides=collect move towards</p>
<p>https://patchwork.data-imaginist.com/reference/plot_layout.html</p>
<p>plot_annotation() to add annotation title = ‘The surprising story about mtcars’ tag_levels = ‘I’ or “A” or “1” to set tag on each plot caption=“Text” theme = theme(plot.title = element_text(size = 16))</p>
<p>use the below to add a blank text tile next to a plot grid::textGrob(‘Some really important text’) or a table gridExtra::tableGrob(mtcars<span class="math display">\[1:10, c('mpg', 'disp')\]</span>)</p>
<p>plot_spacer() inserts an empty plot</p>
<p>inset_element() to insert a sub graph ontop of a new one</p>
<p>left = 0.6, bottom = 0.6, right = 1, top = 1 align_to = ’full</p>
<p>helpful tips:</p>
<p>When creating a patchwork, the resulting object remain a ggplot object referencing the last added plot. This means that you can continue to add objects such as geoms, scales, etc. to it as you would a normal ggplot:When creating a patchwork, the resulting object remain a ggplot object referencing the last added plot. This means that you can continue to add objects such as geoms, scales, etc. to it as you would a normal ggplot:geom_jitter(aes(gear, disp))</p>
<p>Often, especially when it comes to theming, you want to modify everything at once. patchwork provides two additional operators that facilitates this. &amp; will add the element to all subplots in the patchwork, and * will add the element to all the subplots in the current nesting level. As with | and /, be aware that operator precedence must be kept in mind.</p>
<p>str_replace_all //s+ = all white spaces</p>
<p>how to write tables</p>
<p>font 1. Numerical data is right-aligned 2. Textual data is left-aligned 3. Headers are aligned with their data 3½. Don’t use center alignment.</p>
<p>#visual guide ## axis title - axis title always all caps - align top y axis or left axis - color to match axis color ## graph title left alignment</p>
<p>Across(), if_any,if_all</p>
<p>summarize/mutuate/pivot_longer/pivot_wider</p>
<p>across // character based</p>
<p>starts_with</p>
<p>ends_with</p>
<p>contains</p>
<p>matches</p>
<p>num_range()</p>
<p>last_col</p>
<p>where()// with a function that has bolean condition eg. is.numeric</p>
<p>used to select columns by name, position or type (requires where() wrapp)</p>
<p>c(column names), position or type (where)</p>
<p>function, or list( function1=function(), function2=function())</p>
<p>{} is used to refenence preivously declared variables in the glue package or in functions that rerence glue package</p>
<p>some attributes have sepcial references, such as {.col} to reference a column and {.fn} to refernece a function</p>
<p>used in the .names argument of across</p>
<p><code>across()</code> doesn’t work with <code>select()</code> or <code>rename()</code></p>
<p>mutate, group_by,count,distinct,summarize</p>
<p>filter is excluded and instead use if_any and if_all with exceltiion of</p>
<p>filter(across(everything), ~function)</p>
<p>Examples for filter</p>
<ul>
<li><code>if_any()</code> keeps the rows where the predicate is true for <em>at least one</em> selected</li>
</ul>
<p>column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">if_any</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="sc">!</span><span class="fu">is.na</span>(.x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 87 × 14
   name     height  mass hair_color skin_color eye_color birth_year sex   gender
   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
 1 Luke Sk…    172    77 blond      fair       blue            19   male  mascu…
 2 C-3PO       167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
 3 R2-D2        96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
 4 Darth V…    202   136 none       white      yellow          41.9 male  mascu…
 5 Leia Or…    150    49 brown      light      brown           19   fema… femin…
 6 Owen La…    178   120 brown, gr… light      blue            52   male  mascu…
 7 Beru Wh…    165    75 brown      light      blue            47   fema… femin…
 8 R5-D4        97    32 &lt;NA&gt;       white, red red             NA   none  mascu…
 9 Biggs D…    183    84 black      light      brown           24   male  mascu…
10 Obi-Wan…    182    77 auburn, w… fair       blue-gray       57   male  mascu…
# ℹ 77 more rows
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
<ul>
<li><code>if_all()</code> keeps the rows where the predicate is true for <em>all</em> selected columns:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">if_all</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="sc">!</span><span class="fu">is.na</span>(.x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 29 × 14
   name     height  mass hair_color skin_color eye_color birth_year sex   gender
   &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
 1 Luke Sk…    172    77 blond      fair       blue            19   male  mascu…
 2 Darth V…    202   136 none       white      yellow          41.9 male  mascu…
 3 Leia Or…    150    49 brown      light      brown           19   fema… femin…
 4 Owen La…    178   120 brown, gr… light      blue            52   male  mascu…
 5 Beru Wh…    165    75 brown      light      blue            47   fema… femin…
 6 Biggs D…    183    84 black      light      brown           24   male  mascu…
 7 Obi-Wan…    182    77 auburn, w… fair       blue-gray       57   male  mascu…
 8 Anakin …    188    84 blond      fair       blue            41.9 male  mascu…
 9 Chewbac…    228   112 brown      unknown    blue           200   male  mascu…
10 Han Solo    180    80 brown      fair       brown           29   male  mascu…
# ℹ 19 more rows
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
</div>
<ul>
<li>Find all rows where no variable has missing values:</li>
</ul>
<p>Need to investigate rename_with and and itsimpact on select as it appears to be superseded</p>
<p>dplyr/colwise.Rmd at main · tidyverse/dplyr · GitHub</p>
<p>glamour of graphics</p>
<p>alignemtn</p>
<p>top left aligned to the chart left (plot.titile.position=“plot”</p>
<p>add_count(dim,name=“text”) %&gt;% mutate(colname= glue::glue(“{col}{text}”)</p>
<p>rotate lebels, either by swapping axis or removing axis all together</p>
<p>remove borders</p>
<p>remove gridlines</p>
<p>left /right align text to create clean borders</p>
<p>indicate legend in title</p>
<p>graphing tips and tricks</p>
<p>if you want to plot a subset of the data but show atrend agains the full data, leverage the data argument in the each individual geom (rather that defining this globally) (example below)</p>
<p>R-Ladies Freiburg (English) - Level up your ggplot: Adding labels, arrows and other annotations - YouTube</p>
<p>geom_curve</p>
<p>aes(x,y,xend,yend)</p>
<p>arrow=arrow(length=unit(x,“inch)),</p>
<p>size</p>
<p>colr</p>
<p>curvature(0 is straight line, positive is right hand curve, negative is left hand curve)</p>
<p>ggforce package has advanced annotation options</p>
<p>geom_mark_circle</p>
<p>geom_mark_rect</p>
<p>geom_mark_hull</p>
<p>geom_mark_elipse`</p>
<p>aes(label,filter,description)</p>
<p>expand</p>
<p>label.lineheight</p>
<p>label.fontsize</p>
<p>show.legend</p>
<p>ggforce() package</p>
<p>with_blur() can blur the geoms (ten need to seperately map the geoms that you do want to show</p>
<p>need to warp the geom_jitter comand in with_blur</p>
<p>with_blur(</p>
<p>geom_jitter(),</p>
<p>sigma = unit(#,“mm”) #blur impact</p>
<p>facet_zoom()# takes a larger dataset and then adds in a zoomed up graph</p>
<p>facet_zoom(axis =argument==filterar_gument)</p>
<p>facet_zoom(x=country==“spain”)</p>
<p>facet_zoom(y=length &lt;20)</p>
<p>Programming with dplyr • dplyr (tidyverse.org)</p>
<p>Argument type: tidy-select — dplyr_tidy_select • dplyr (tidyverse.org)</p>
<p>Tidy evaluation is not all-or-nothing, it encompasses a wide range of features and techniques. Here are a few techniques that are easy to pick up in your workflow:</p>
<p>Passing expressions through {{ and ….</p>
<p>Passing column names to .data[[ and one_of().</p>
<p>All these techniques make it possible to reuse existing comp</p>
<p>When creating forumlas how to referece to names?</p>
<p>STart with fixed names (only if you are sure it wont change) and try wrapping that around a test to ensur eit exists</p>
<p>duoble currly braces {{}}</p>
<p>When you want to reference a data variable from an env. variable in function, you pass the dataframe to the function then wrap the data var with {{var}} in order pull it from the env frame (instead of saying data$x)</p>
<p>where() for search paramters</p>
<p>.data[[var]]</p>
<p>if you env variable is a character frame that you must use .data[[var]]</p>
<p>all_of or any_of for character vectors for search praramters</p>
<!-- -->
<p>compute_bmi &lt;- function(data) { if (!all(c(“mass”, “height”) %in% names(data))) { stop(“<code>data</code> must contain <code>mass</code> and <code>height</code> columns”) }</p>
<p>data %&gt;% transmute(bmi = mass / height^2) }</p>
<p>how to use as nmaes</p>
<p>“mean_{{var}}” := mean({{var}})</p>
<p>Open questions</p>
<p>when do you sue data and when do use .data (okay answer apparently when you use … you start other variables with “.” eg. .data to avoid conflictino ix | Tidyverse design guide</p>
<p>)</p>
<p>f you want the user to provide a set of data-variables that are then transformed, use across():</p>
<p>my_summarise &lt;- function(data, summary_vars) { data %&gt;% summarise(across({{ summary_vars }}, ~ mean(., na.rm = TRUE))) } starwars %&gt;% group_by(species) %&gt;% my_summarise(c(mass, height)) #&gt; # A tibble: 38 × 3 #&gt; species mass height #&gt; <chr> <dbl> <dbl> #&gt; 1 Aleena 15 79 #&gt; 2 Besalisk 102 198 #&gt; 3 Cerean 82 198 #&gt; 4 Chagrian NaN 196 #&gt; # … with 34 more rows</dbl></dbl></chr></p>
<p>You can use this same idea for multiple sets of input data-variables:</p>
<p>my_summarise &lt;- function(data, group_var, summarise_var) { data %&gt;% group_by(across({{ group_var }})) %&gt;% summarise(across({{ summarise_var }}, mean)) }</p>
<p>Use the .names argument to across() to control the names of the output.</p>
<p>my_summarise &lt;- function(data, group_var, summarise_var) { data %&gt;% group_by(across({{ group_var }})) %&gt;% summarise(across({{ summarise_var }}, mean, .names = “mean_{.col}”)) }</p>
<p>Action versb to know how to use</p>
<p>Argument type: tidy-select — dplyr_tidy_select • dplyr (tidyverse.org)</p>
<p>everything(): Matches all variables.</p>
<p>last_col(): Select last variable, possibly with an offset.</p>
<p>These helpers select variables by matching patterns in their names:</p>
<p>starts_with(): Starts with a prefix.</p>
<p>ends_with(): Ends with a suffix.</p>
<p>contains(): Contains a literal string.</p>
<p>matches(): Matches a regular expression.</p>
<p>num_range(): Matches a numerical range like x01, x02, x03.</p>
<p>These helpers select variables from a character vector:</p>
<p>all_of(): Matches variable names in a character vector. All names must be present, otherwise an out-of-bounds error is thrown.</p>
<p>any_of(): Same as all_of(), except that no error is thrown for names that don’t exist.</p>
<p>This helper selects variables with a function:</p>
<p>where(): Applies a function to all variables and selects those for which the function returns TRUE.</p>
<p>arrange(), count(), filter(), group_by(), mutate(), and summarise() use data masking so that you can use data variables as if they were variables in the environment (i.e.&nbsp;you write my_variable not df$myvariable).</p>
<p>across(), relocate(), rename(), select(), and pull()</p>
<p>rowwise()</p>
<p>colwise()</p>
<p>Tricks</p>
<p>mean in summarize will give you the portion of that variable per the group</p>
<p>purr</p>
<p>resources</p>
<p>9 Basic map functions | Functional Programming (stanford.edu)</p>
<p>Map and Nested Lists | R-bloggers</p>
<p>pattern</p>
<p>take one element .x&lt;-list[[1]]</p>
<p>do the formula based on that element</p>
<p>set_names() without argument sets the names equal to the values</p>
<p>map returns list, control map outcomes with map alternatives eg. map_df, map_dbl</p>
<p>if function has more than one argument then define a function upfront in global environment and pass the second y argument as explicit command in map [follow up how to do this in anonymous way)</p>
<p>map(1:5,custom_function,y=2)</p>
<p>pmap for more than one vector</p>
<p>can also pass through functions as objects not just data</p>
<p>funs&lt;- list(mean,median,sd)</p>
<p>map(funs,~map_dbl(mtcars,.x))</p>
<p>start on the inside and then work your way to the outside</p>
<p>walk similiar ot map but is design for function that you want to run soley for hte side effects</p>
<p>so walk will always return the origional vector eg. walk(.x,.f)=&gt; .x whereas map will return map(.x,.f)=&gt; .f(.x.</p>
<p>So why use walk? when you want the formula side effectt (eg saving a picture)</p>
<p>accumulate</p>
<p>applies same function again and again and again</p>
<p>applies function to first argument then takes that result and applies that outcome to second argument</p>
<p>eg. accumulate(letters,paste), will produce a prymid of values of all the letters</p>
<p>so accumlate will show all the interim values</p>
<p>reduce will only show the final value</p>
<p>this is recursive</p>
<p>However, if you want pair wise actions 1<em>1, 2</em>2, etc then you need map2</p>
<p>tidytext</p>
<p>unnest_tokens basically takes a string and breaks t into characters, words, or others ngrams,</p>
<p>From there use typical dplybs to graph, popular geoms are geom_text to plot the words aagainst their proportion.</p>
<p>typiecal tokenize methodologies use ICI (international components of unicode) which defines word boundaries )</p>
<p>Chapter 2 Tokenization | Supervised Machine Learning for Text Analysis in R (smltar.com)</p>
<p>packages</p>
<p>tidytext</p>
<p>tokenize</p>
<p>stopwords</p>
<p>SnowballC for stemming</p>
<p>hunspell also for stemming / spell check</p>
<p>types of toekn</p>
<p>characters</p>
<p>words,</p>
<p>sentences</p>
<p>lines,</p>
<p>paragraphs</p>
<p>ngrams</p>
<p>you can use tidytext package or tokenize package but here is your pattern</p>
<p>grab text</p>
<p>add a dimenion factor (eg. chapter, author, book)</p>
<p>nest the data by the dimension</p>
<p>if data is nested use mutate(map()) pattern to perform transformations</p>
<p>if doing setences or paragraphs you may need to paste() the text and add paragraph breaks “” (paragraphs) or space breaks ” ” (sentences)</p>
<p>then use either tidytext(returns tibble) or tokenizer (returns lists) to do unnesting work</p>
<p>unnest data</p>
<p>anti_join(stop_words)</p>
<p>regex considerations</p>
<p>[:alpha:] brings in non US lettesr where as [a-zA-Z] only brings in US letters</p>
<p>? is optional (will match or not)</p>
<p>^ starts with</p>
<p>$ends with</p>
<div class="line-block">or</div>
<p>stop words</p>
<p>stopwords package with snowball, iso and other packages</p>
<p>stemming</p>
<p>can stem words tree, tree’s into single word</p>
<p>however also has impact of creating new words to stem by</p>
<p>SnowballC package offers wordStem</p>
<p>tokenizer::tokenize_word_stems</p>
<p>hunspell:hunspell_stem</p>
<p>more resources</p>
<p>Chapter 2 Tokenization | Supervised Machine Learning for Text Analysis in R (smltar.com)</p>
<p>tidytext</p>
</section>
<section id="tidy-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="tidy-evaluation">tidy evaluation</h2>
<p>resources</p>
<p>2 Why and how | Tidy evaluation (tidyverse.org)</p>
<p>Programming with dplyr • dplyr (tidyverse.org)</p>
<p>Implementing tidyselect interfaces • tidyselect (r-lib.org)</p>
<p>Technical description of tidyselect • tidyselect (r-lib.org)</p>
<p>13 Tidy evaluation basics | Functional Programming (stanford.edu)</p>
<p>principles</p>
<p>data masking is when you delay the evaluation of a code so that the code can find relevant columns for computation. th</p>
<p>This is why you can can do::</p>
<p>{r}</p>
<p>#this will work starwars %&gt;% filter( height &lt; 200, gender == “male” )</p>
<p>#but really the program needs this, reference to dataframe and column starwars[starwars<span class="math inline">\(height &lt; 200 &amp; starwars\)</span>gender == “male”, ]</p>
<p>technical term for delaying code is quoting</p>
<p>this delaying of code evalution can help you when using code but also make things more complicated when writing code</p>
<p>vectoring can occur when either input has 1 or same length of input object to ensure all columns have same length</p>
<p>some functions can repeat values if recycling completes the length</p>
<p>howevre other,like tidyverse family don’t</p>
<p>!! takes a variable defined outside of function and allows you to use it within a function x&lt;-1 function(x) !!x+1, qq_show() allows you to see what is happening</p>
<p>!! works for assiging a variable not a column name or only variable</p>
<p>!! is simliar to := but := is only for left hand side eg setting a name</p>
<p>when working with lists you need !!! to pull out each element and pass it through otherwise !! just pass through the list as is also need to use enquos() vs.&nbsp;enquo</p>
<p>sym) is how you quote for column names and !! is how you unquote, however sym() only works for character strings so “mpg” vs.&nbsp;mpg</p>
<p>enquo is used for non character strings and then !! is how you unquote them</p>
<p>rlang::qq_show will help show what how !! is being evaluated</p>
<p>pattersn</p>
<p>enquo() and !!</p>
<p>:= and !!</p>
<p>enquos() and !!!</p>
<p>how to use environment character vectors in a function or formula? - use all_of() or any_of() (use ! to negate) <a href="https://dplyr.tidyverse.org/articles/programming.html">linkhere</a> - you can also suse sym or syms with !!! <a href="https://stackoverflow.com/questions/34487641/dplyr-groupby-on-multiple-columns-using-variable-names">link here</a></p>
<p>how to quote a uncharacter argument into a character arugment - dots &lt;- enquos(…, .named = TRUE) will turn a unquoted input into a quosure variable - nm1 &lt;- purrr::map_chr(dots, rlang::as_label) then use this to transform into character vectors which canbe used in functions <a href="https://stackoverflow.com/questions/63257632/curly-curly-tidy-evaluation-programming-with-multiple-inputs-and-custom-function">linkhere</a></p>
<p>#PCA</p>
<p>pca_rec &lt;- recipe(~., data = sample_df) %&gt;% update_role(daily_miss, new_role = “id”) %&gt;% step_normalize(all_predictors()) %&gt;% step_pca(all_predictors())</p>
<p>pca_prep &lt;- prep(pca_rec)</p>
<p>pca_prep</p>
<p>tidied_pca &lt;- tidy(pca_prep, 2)</p>
<p>tidied_pca %&gt;% filter(component %in% paste0(“PC”, 1:5)) %&gt;% mutate(component = fct_inorder(component)) %&gt;% ggplot(aes(value, terms, fill = terms)) + geom_col(show.legend = FALSE) + facet_wrap(~component, nrow = 1) + labs(y = NULL)</p>
<p>princomp with plot(pca_mod, type=“lines”).</p>
</section>
<section id="advanced-plotting-contorl-over-color-shape-or-alpha" class="level2">
<h2 class="anchored" data-anchor-id="advanced-plotting-contorl-over-color-shape-or-alpha">advanced plotting, contorl over color, shape or alpha——</h2>
<ol type="1">
<li>add column that by attribution (eg. color, shape,alpha)</li>
<li>use case_when that identifies row attributes and gives the custom formatting</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>diamonds_formatting <span class="ot">&lt;-</span> diamonds <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="at">custom_col=</span> <span class="fu">case_when</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">between</span>(price, <span class="dv">400</span>,<span class="dv">2000</span>) <span class="sc">~</span> <span class="st">'grey60'</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  price <span class="sc">&lt;</span> <span class="dv">5000</span> <span class="sc">~</span> <span class="st">"red"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  price <span class="sc">&lt;</span> <span class="dv">10000</span> <span class="sc">~</span> <span class="st">"blue"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  price <span class="sc">&lt;</span> <span class="dv">20000</span> <span class="sc">~</span> <span class="st">"purple"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  color <span class="sc">==</span><span class="st">"G"</span> <span class="sc">~</span> <span class="st">'#AA4465'</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"orange"</span>),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="at">custom_shape=</span><span class="fu">case_when</span>(</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  color <span class="sc">==</span><span class="st">"G"</span> <span class="sc">|</span>color<span class="sc">==</span><span class="st">"E"</span> <span class="sc">~</span> <span class="dv">13</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">4</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>pass arguments to ggplot mapping the col, shape, alpha to the respective columns</li>
<li><strong>must</strong> add <code>scale_*_identity()</code> to the plot for this to work</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>diamonds_formatting <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(price,color,<span class="at">col=</span>custom_col,<span class="at">shape=</span>custom_shape))<span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_identity</span>()<span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_identity</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="learningR_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="5" type="1">
<li>source (https://alberts-newsletter.beehiiv.com/)[]</li>
</ol>
<p>#tidyselect verbs</p>
<p>contains() starts_with() ends_with() 1:10 a:b last_col() -offset=X –offset argument matches() num_range() -needs arguments</p>
<p>based on character names all_of() any_of()</p>
<p>pass a formula to check against each column where() -is.numeric() -is.factor() ~mean(.x) &gt;3.5</p>
<section id="common-tasks" class="level3">
<h3 class="anchored" data-anchor-id="common-tasks">common tasks—</h3>
<p>apply a function to multiple columns to perform action onto column or new columns - Across() apply a column of arguments, one by one, as input into a function - map() apply two or more column of arguments as simulataneous inputs into a function - map2() apply one column of arguments as input to function, then combine output with new argument - purrr::reduce()</p>
<p>apply a function to pairs of columns on a rolling basis (eg. col 1 -2, col 2 - 3, etc) ????</p>
</section>
</section>
<section id="count" class="level2">
<h2 class="anchored" data-anchor-id="count">count</h2>
<p>count very useful function to quickly tabulate data use .drop to show any data that has been filtered out or removed</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="how-to-parse-out-words-from-a-sentence" class="level3">
<h3 class="anchored" data-anchor-id="how-to-parse-out-words-from-a-sentence">how to parse out words from a sentence</h3>
<ul>
<li>fixed position and fixed seperated but whole word (seperated by consistent seperator</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"I only want the third word of each sentence"</span>,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">"I only need the third word of each setence"</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"I only use the third worsd of each sentence"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>stringr<span class="sc">::</span><span class="fu">word</span>(string, <span class="co">#vector of strings</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">start=</span><span class="dv">3</span>, <span class="co">#where to start extraction</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">end=</span><span class="dv">3</span>, <span class="co">#where to end extraction</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">sep=</span><span class="st">" "</span>)<span class="co"># what seperator to parse</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "want" "need" "use" </code></pre>
</div>
</div>
<p>stringr::word(string,start=x,end=y,sep=?)</p>
<p>is.element(input,check_strings) – validates inputs matches at least one in a set</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>